"use strict";(self["webpackChunks024"]=self["webpackChunks024"]||[]).push([[1150],{623:(e,t,s)=>{s.r(t),s.d(t,{default:()=>g});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-edit"},[t("Modal",{attrs:{title:e.title,width:"90",draggable:"","mask-closable":"0"==e.type,"ok-text":"确认提交"},on:{"on-ok":e.submit},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("Row",{attrs:{gutter:16,justify:"center"}},[t("div",{staticClass:"info-title"},[t("span",{directives:[{name:"show",rawName:"v-show",value:"2"!=e.type,expression:"type!='2'"}]},[e._v("登录账号"+e._s(e.form.username)+"（唯一标识"+e._s(e.form.id)+"） ")]),t("Icon",{directives:[{name:"show",rawName:"v-show",value:-1==e.form.status,expression:"form.status==-1"}],staticStyle:{"margin-left":"10px",cursor:"pointer"},attrs:{type:"md-lock",size:"18"}})],1)]),t("Form",{ref:"form",attrs:{model:e.form,rules:e.formValidate,"label-position":"top"}},["2"==e.type?t("Row",{attrs:{gutter:16}},[t("Col",{attrs:{span:"12"}},[t("FormItem",{staticStyle:{width:"100%"},attrs:{label:"登录账号",prop:"username"}},[t("Input",{attrs:{autocomplete:"off",maxlength:16},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1)],1),t("Col",{attrs:{span:"12"}},[t("FormItem",{staticStyle:{width:"100%"},attrs:{label:"密码",prop:"password"}},[t("SetPassword",{on:{"on-change":e.changePass},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)],1)],1):e._e(),t("Row",{attrs:{gutter:16}},[t("Col",{attrs:{span:"12"}},[t("FormItem",{staticStyle:{width:"100%"},attrs:{label:"用户名",prop:"nickname"}},[t("Input",{model:{value:e.form.nickname,callback:function(t){e.$set(e.form,"nickname",t)},expression:"form.nickname"}})],1)],1),t("Col",{attrs:{span:"12"}},[t("FormItem",{staticStyle:{width:"100%"},attrs:{label:"邮箱",prop:"email"}},[t("Input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1)],1)],1),t("Row",{attrs:{gutter:16}},[t("Col",{attrs:{span:"12"}},[t("FormItem",{staticStyle:{width:"100%"},attrs:{label:"手机号",prop:"mobile"}},[t("Input",{model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1)],1),t("Col",{attrs:{span:"12"}},[t("FormItem",{staticStyle:{width:"100%"},attrs:{label:"性别"}},[t("dict",{attrs:{dict:"sex",transfer:"",clearable:"",placeholder:"选择性别"},model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}})],1)],1)],1),t("Row",{attrs:{gutter:16}},[t("Col",{attrs:{span:"12"}},[t("FormItem",{staticStyle:{width:"100%"},attrs:{label:"所属部门"}},[t("department-tree-choose",{ref:"depTree",on:{"on-change":e.handleSelectDepTree}})],1)],1),t("Col",{attrs:{span:"12"}},[t("FormItem",{staticStyle:{width:"100%"},attrs:{label:"用户类型"}},[t("Select",{attrs:{placeholder:"请选择用户类型"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[t("Option",{attrs:{value:0}},[e._v("普通用户")]),t("Option",{attrs:{value:1}},[e._v("管理员")])],1)],1)],1)],1),t("Row",{attrs:{gutter:16}},[t("Col",{attrs:{span:"12"}},[t("FormItem",{staticStyle:{width:"100%"},attrs:{label:"头像"}},[t("upload-pic-input",{model:{value:e.form.avatar,callback:function(t){e.$set(e.form,"avatar",t)},expression:"form.avatar"}})],1)],1),t("Col",{attrs:{span:"12"}},[t("FormItem",{staticStyle:{width:"100%"},attrs:{label:"角色",prop:"roleIds"}},[t("Select",{attrs:{multiple:""},model:{value:e.form.roleIds,callback:function(t){e.$set(e.form,"roleIds",t)},expression:"form.roleIds"}},e._l(e.roleList,(function(s){return t("Option",{key:s.id,attrs:{value:s.id,label:s.name}},[t("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(s.name))]),t("span",{staticStyle:{color:"#ccc"}},[e._v(e._s(s.description))])])})),1)],1)],1)],1)],1)],1)],1)},i=[],r=s(5894),l=s(6551),o=s(4339),n=s(6413),c=s(7204),d=s(8188);const m={name:"user",components:{departmentTreeChoose:o["default"],uploadPicInput:n["default"],SetPassword:c["default"],dict:d["default"]},props:{value:{type:Boolean,default:!1},data:{type:Object},type:{type:String,default:"0"}},data(){return{visible:this.value,title:"",passColor:"",submitLoading:!1,form:{addressArray:[]},formValidate:{username:[{required:!0,message:"请输入登录账号",trigger:"blur"},{validator:l.rV,trigger:"blur"}],nickname:[{required:!0,message:"请输入用户名",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:l.gG,trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:l.uo,trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址"},{type:"email",message:"邮箱格式不正确"}]},roleList:[]}},methods:{init(){this.getRoleList()},getRoleList(){(0,r.pC)().then((e=>{e.success&&(this.roleList=e.result)}))},handleSelectDepTree(e){this.form.departmentId=e},changeAddress(e){this.form.address=JSON.stringify(this.form.addressArray)},changePass(e,t,s){this.form.passStrength=s},submit(){this.$refs.form.validate((e=>{e&&("1"==this.type?(this.submitLoading=!0,(0,r.uz)(this.form).then((e=>{this.submitLoading=!1,e.success&&(this.$Message.success("操作成功"),this.$emit("on-submit",!0),this.visible=!1)}))):(this.submitLoading=!0,(0,r.cn)(this.form).then((e=>{this.submitLoading=!1,e.success&&(this.$Message.success("操作成功"),this.$emit("on-submit",!0),this.visible=!1)}))))}))},setCurrentValue(e){if(e!==this.visible){if("1"==this.type?this.title="编辑":"2"==this.type?this.title="添加":this.title="详情",this.$refs.form.resetFields(),"0"==this.type||"1"==this.type){let e=this.data;e.address?e.addressArray=JSON.parse(e.address):e.addressArray=[],this.$refs.depTree.setData(e.departmentId,e.departmentTitle);let t=[];e.roles.forEach((function(e){t.push(e.id)})),e.roleIds=t,delete e.roles,delete e.permissions,"弱"==e.passStrength?this.passColor="#ed3f14":"中"==e.passStrength?this.passColor="#faad14":"强"==e.passStrength&&(this.passColor="#52c41a"),this.form=e}else this.$refs.depTree.setData("",""),this.form={type:0,sex:"",addressArray:[]};this.visible=e}}},watch:{value(e){this.setCurrentValue(e)},visible(e){this.$emit("input",e)}},mounted(){this.init()}},h=m;var p=s(1001),u=(0,p.Z)(h,a,i,!1,null,null,null);const g=u.exports},514:(e,t,s)=>{s.r(t),s.d(t,{default:()=>u});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"search"},[t("Card",[t("Row",[t("Form",{ref:"searchForm",attrs:{model:e.searchForm,inline:"","label-width":40}},[t("Form-item",{attrs:{label:"姓名",prop:"nickname"}},[t("Input",{staticStyle:{width:"160px"},attrs:{type:"text",clearable:"",placeholder:"搜索姓名"},model:{value:e.searchForm.nickname,callback:function(t){e.$set(e.searchForm,"nickname",t)},expression:"searchForm.nickname"}})],1),t("Form-item",{attrs:{label:"部门",prop:"department"}},[t("department-choose",{ref:"dep",staticStyle:{width:"160px"},attrs:{placeholder:"用户部门"},on:{"on-change":e.handleSelectDep}})],1),t("Form-item",{staticClass:"br",staticStyle:{"margin-left":"10px"}},[t("Button",{attrs:{type:"primary",icon:"ios-search",ghost:"",shape:"circle",size:"small"},on:{click:e.handleSearch}},[e._v("搜索")]),t("Button",{attrs:{type:"warning",ghost:"",shape:"circle",icon:"md-refresh",size:"small"},on:{click:e.handleReset}},[e._v("重置")]),t("Button",{attrs:{type:"info",icon:"md-add",ghost:"",shape:"circle",size:"small",disabled:!e.$route.meta.permTypes.includes("add")},on:{click:e.add}},[e._v("添加")]),t("Button",{attrs:{type:"success",icon:"md-paper-plane",ghost:"",shape:"circle",size:"small"},on:{click:function(t){e.importModalVisible=!0}}},[e._v("导入")]),t("Button",{attrs:{type:"success",icon:"md-paper-plane",ghost:"",shape:"circle",size:"small"},on:{click:e.excelData}},[e._v("导出")])],1),t("Form-item",{staticStyle:{position:"fixed",right:"50px",top:"130px"}},[t("Button",{staticClass:"showFilterPanelFlag",attrs:{type:"info",icon:"md-settings",size:"small",ghost:""},on:{click:function(t){e.showFilterPanelFlag=!e.showFilterPanelFlag}}},[e._v(" 列筛选")]),t("Button",{staticClass:"showFilterPanelFlag",attrs:{type:"warning",icon:"ios-help-circle-outline",size:"small",ghost:""},on:{click:function(t){e.usingTutorialsModal=!0}}},[e._v(" 使用教程")]),t("Modal",{attrs:{title:"使用教程"},model:{value:e.usingTutorialsModal,callback:function(t){e.usingTutorialsModal=t},expression:"usingTutorialsModal"}},[t("p",[e._v("1.XXXXXXXXXXXXXXXXXXXXXXXX")]),t("p",[e._v("2.XXXXXXXXXXXXXXXXXXXXXXXX")]),t("p",[e._v("3.XXXXXXXXXXXXXXXXXXXXXXXX")])])],1)],1)],1),t("Row",{staticClass:"operation",staticStyle:{position:"relative"}},[t("transition",[t("div",{directives:[{name:"show",rawName:"v-show",value:e.showFilterPanelFlag,expression:"showFilterPanelFlag"}],staticClass:"filter-panel"},[t("CheckboxGroup",{model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},e._l(e.mycolumns,(function(e){return t("div",{key:e.key},[t("Checkbox",{staticStyle:{margin:"2px 5px"},attrs:{label:e.title}})],1)})),0)],1)])],1),t("Row",[t("Table",{ref:"table",attrs:{loading:e.loading,border:"",stripe:"",height:e.height,columns:e.columns,data:e.data,sortable:"custom","row-class-name":e.rowClassName},on:{"on-sort-change":e.changeSort,"on-selection-change":e.showSelect,"on-row-click":e.rowClick}})],1),t("Row",{staticClass:"page",attrs:{type:"flex",justify:"end"}},[t("Page",{attrs:{current:e.searchForm.pageNumber,total:e.total,"page-size":e.searchForm.pageSize,"page-size-opts":[20,30,50],size:"small","show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)],1),t("Drawer",{attrs:{title:"导入数据",closable:"",width:"1000"},model:{value:e.importModalVisible,callback:function(t){e.importModalVisible=t},expression:"importModalVisible"}},[t("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[t("Upload",{attrs:{action:"","before-upload":e.beforeUploadImport,accept:".xls, .xlsx"}},[t("Button",{staticStyle:{"margin-right":"10px"},attrs:{loading:e.reading,icon:"ios-cloud-upload-outline"}},[e._v("上传Excel文件")]),e.uploadfile.name?t("span",[e._v("当前选择文件："+e._s(e.uploadfile.name))]):e._e()],1),t("Button",{attrs:{icon:"md-trash"},on:{click:e.clearImportData}},[e._v("清空数据")])],1),t("Table",{ref:"importTable",attrs:{columns:e.importColumns,border:"",height:e.height,data:e.importTableData}}),t("div",{staticClass:"drawer-footer"},[t("div",{staticStyle:{position:"absolute",right:"15px",display:"inline-block"}},[t("Button",{on:{click:function(t){e.importModalVisible=!1}}},[e._v("关闭")]),t("Button",{staticStyle:{"margin-left":"8px"},attrs:{loading:e.importLoading,disabled:e.importTableData.length<=0,type:"primary"},on:{click:e.importData}},[e._v(" 确认导入 "),e.importTableData.length>0?t("span",[e._v(e._s(e.importTableData.length)+" 条数据")]):e._e()])],1)])],1),t("addEdit",{attrs:{data:e.form,type:e.showType},on:{"on-submit":e.getUserList},model:{value:e.showUser,callback:function(t){e.showUser=t},expression:"showUser"}})],1)},i=[],r=s(5894),l=s(8387),o=s(805),n=s(623),c=s(8188);const d={name:"user-manage",components:{departmentChoose:l["default"],addEdit:n["default"],dict:c["default"]},data(){return{selected:["编号","用户名","登录账号","头像","所属部门","手机","邮箱","性别","类型","状态","创建时间","操作"],showFilterPanelFlag:!1,usingTutorialsModal:!1,height:510,selectRow:{},showUser:!1,showType:"0",loading:!0,reading:!1,importLoading:!1,loadingExport:!0,exportModalVisible:!1,importModalVisible:!1,drop:!1,selectCount:0,selectList:[],searchForm:{nickname:"",departmentId:"",pageNumber:1,pageSize:20,sort:"createTime",order:"desc"},form:{},columns:[{title:"编号",type:"index",width:80,align:"center",fixed:"left"},{title:"用户名",key:"nickname",minWidth:150,sortable:!0,fixed:"left"},{title:"登录账号",key:"username",minWidth:150,sortable:!0},{title:"头像",key:"avatar",width:80,align:"center",render:(e,t)=>e("Avatar",{props:{src:t.row.avatar}})},{title:"所属部门",key:"departmentTitle",minWidth:120},{title:"手机",key:"mobile",minWidth:125,sortable:!0},{title:"邮箱",key:"email",minWidth:180,sortable:!0},{title:"性别",key:"sex",width:70,align:"center"},{title:"类型",key:"type",align:"center",width:100,render:(e,t)=>1==t.row.type?e("div",[e("span",{style:{color:"#ff9900"}},"管理员")]):e("div",["普通用户"])},{title:"状态",key:"status",align:"center",width:110,render:(e,t)=>0==t.row.status?e("div",[e("span",{style:{color:"#3CB371"}},"正常启用")]):e("div",[e("span",{style:{color:"#ff9900"}},"禁用")])},{title:"创建时间",key:"createTime",sortable:!0,sortType:"desc",width:180},{title:"操作",key:"action",width:300,align:"center",fixed:"right",render:(e,t)=>{var s=this;return e("div",[e("Button",{props:{type:"primary",size:"small",ghost:!0,shape:"circle",disabled:!(s.$route.meta.permTypes&&s.$route.meta.permTypes.includes("edit"))},style:{marginRight:"5px"},on:{click:()=>{this.edit(t.row)}}},"编辑"),e("Button",{props:{type:"warning",size:"small",ghost:!0,shape:"circle"},style:{marginRight:"5px"},on:{click:()=>{this.resetPass(t.row)}}},"重置密码"),e("Button",{props:{size:"small",ghost:!0,type:0==t.row.status?"error":"success",shape:"circle"},style:{marginRight:"5px"},on:{click:()=>{0==t.row.status?this.disable(t.row):this.enable(t.row)}}},0==t.row.status?"禁用":"启用"),e("Button",{props:{type:"error",size:"small",ghost:!0,shape:"circle",disabled:!(s.$route.meta.permTypes&&s.$route.meta.permTypes.includes("delete"))},on:{click:()=>{this.remove(t.row)}}},"删除")])}}],filename:"用户数据",importTableData:[],importColumns:[],uploadfile:{name:""},data:[],total:0}},methods:{init(){this.getUserList()},excelData(){this.$refs.table.exportCsv({filename:"导出结果"})},handleSelectDep(e){this.searchForm.departmentId=e},changePage(e){this.searchForm.pageNumber=e,this.getUserList(),this.clearSelectAll()},changePageSize(e){this.searchForm.pageSize=e,this.getUserList()},getUserList(){this.loading=!0,(0,r.lE)(this.searchForm).then((e=>{this.loading=!1,e.success&&(this.data=e.result.records,this.total=e.result.total)}))},handleSearch(){this.searchForm.pageNumber=1,this.searchForm.pageSize=20,this.getUserList()},handleReset(){this.$refs.searchForm.resetFields(),this.searchForm.pageNumber=1,this.searchForm.pageSize=10,this.$refs.dep.clearSelect(),this.searchForm.departmentId="",this.getUserList()},changeSort(e){this.searchForm.sort=e.key,this.searchForm.order=e.order,"normal"==e.order&&(this.searchForm.order=""),this.getUserList()},resetPass(e){this.$Modal.confirm({title:"确认重置",content:"重置后密码为123456",loading:!0,onOk:()=>{(0,r.M7)({ids:e.id}).then((e=>{this.$Modal.remove(),e.success&&(this.$Message.success("操作成功"),this.clearSelectAll(),this.getUserList())}))}})},beforeUploadImport(e){this.uploadfile=e;const t=e.name.split(".").pop().toLocaleLowerCase();return"xlsx"==t||"xls"==t?(this.readFile(e),this.file=e):this.$Message.error("不是Excel文件"),!1},readFile(e){this.reading=!0;const t=new FileReader;t.readAsArrayBuffer(e),t.onerror=e=>{this.reading=!1,this.$Message.error("文件读取出错")},t.onload=e=>{const t=e.target.result,{header:s,results:a}=o.ZP.read(t,"array"),i=s.map((e=>({title:e,key:e,minWidth:100,align:"center"})));this.importTableData=a,this.importColumns=i,this.reading=!1,this.$Message.success("读取数据成功")}},clearImportData(){this.importTableData=[],this.importColumns=[],this.uploadfile={}},importData(){this.importLoading=!0,(0,r.Vp)(this.importTableData).then((e=>{this.importLoading=!1,e.success&&(this.importModalVisible=!1,this.getUserList(),this.$Modal.info({title:"导入结果",content:e.message}))}))},add(){this.showType="2",this.showUser=!0},edit(e){for(let a in e)null==e[a]&&(e[a]="");let t=JSON.stringify(e),s=JSON.parse(t);this.form=s,this.showType="1",this.showUser=!0},enable(e){this.$Modal.confirm({title:"确认启用",content:"启用用户 "+e.username+" ?",loading:!0,onOk:()=>{(0,r.Dx)({id:e.id}).then((e=>{this.$Modal.remove(),e.success&&(this.$Message.success("启用成功"),this.getUserList())}))}})},disable(e){this.$Modal.confirm({title:"确认禁用",content:"禁用用户 "+e.username+" ?",loading:!0,onOk:()=>{(0,r.B9)({id:e.id}).then((e=>{this.$Modal.remove(),e.success&&(this.$Message.success("禁用成功"),this.getUserList())}))}})},remove(e){this.$Modal.confirm({title:"确认删除",content:"删除用户 "+e.username+" ?",loading:!0,onOk:()=>{(0,r.h8)({ids:e.id}).then((e=>{this.$Modal.remove(),e.success&&(this.$Message.success("删除成功"),this.getUserList())}))}})},showSelect(e){this.selectList=e,this.selectCount=e.length},clearSelectAll(){this.$refs.table.selectAll(!1)},rowClick(e,t){this.selectRow=e},rowClassName(e,t){return e.id==this.selectRow.id?"rowClassNameColor":""}},mounted(){this.height=window.innerHeight-this.$refs.table.$el.offsetTop-160,this.init(),this.mycolumns=this.columns;let e=[];for(var t=0;t<this.selected.length;t++)for(var s=this.selected[t],a=0;a<this.columns.length;a++)this.columns[a].title==s&&e.push(this.columns[a]);this.columns=e},watch:{selected:function(e){let t=[];for(var s=0;s<this.mycolumns.length;s++){var a=this.mycolumns[s];(void 0==a.title||e.includes(a.title))&&t.push(a)}this.columns=t}}},m=d;var h=s(1001),p=(0,h.Z)(m,a,i,!1,null,null,null);const u=p.exports},5894:(e,t,s)=>{s.d(t,{B9:()=>l,Dx:()=>r,M7:()=>c,Vp:()=>n,cn:()=>m,h8:()=>o,lE:()=>i,pC:()=>d,uz:()=>h});var a=s(7184);const i=e=>(0,a.A_)("/user/getUserList",e),r=e=>(0,a.j0)("/user/enable",e),l=e=>(0,a.j0)("/user/disable",e),o=e=>(0,a.j0)("/user/delByIds",e),n=e=>(0,a.oZ)("/user/importData",e),c=e=>(0,a.j0)("/user/resetPass",e),d=e=>(0,a.A_)("/role/getAllList",e),m=e=>(0,a.j0)("/user/admin/add",e),h=e=>(0,a.j0)("/user/admin/edit",e)}}]);